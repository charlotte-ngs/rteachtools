<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploying Exercises To Different Output Instances â€¢ rteachtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Deploying Exercises To Different Output Instances">
<meta property="og:description" content="rteachtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rteachtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/convert_to_nb.html">Create Exercise Notebooks</a>
    </li>
    <li>
      <a href="../articles/deploy_ex.html">Deploying Exercises To Different Output Instances</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/charlotte-ngs/rteachtools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="deploy_ex_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="deploy_ex_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="deploy_ex_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deploying Exercises To Different Output Instances</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/charlotte-ngs/rteachtools/blob/master/vignettes/deploy_ex.Rmd"><code>vignettes/deploy_ex.Rmd</code></a></small>
      <div class="hidden name"><code>deploy_ex.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://charlotte-ngs.github.io/rteachtools/">rteachtools</a></span><span class="op">)</span></code></pre></div>
<div id="disclaimer" class="section level1">
<h1 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h1>
<p>The concepts behind the deployment process of different output instances of exercises are outlined.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>The deployment process of an exercise consists of the rendering of the source Rmd file to the required output documents which are published to the students. The published documents consist of a pdf-document that is made available on the website. On the exercise platform, an RStudio notebook is given to the students. The students can self-check their solutions with a document that contains the master-solutions.</p>
<p>The deployment process must be easy and seamless, because the time spent for the deployment should be minimal and the deployment must be fast. The reasons for this is that the time spent to develop new exercise should be maximal and in case when an error is found somewhere in the exercise, the correction and re-deployment should be possible with a single function call.</p>
</div>
<div id="unified-rmd-source" class="section level1">
<h1 class="hasAnchor">
<a href="#unified-rmd-source" class="anchor"></a>Unified Rmd Source</h1>
<p>Problems and solutions of exercises are all written in one single unified Rmarkdown source file. This source files also contains additional information that is only shown in specific output instances. The different sections in the source file are indicated with tags. The tags are hidden in comments for Markdown or HTML.</p>
</div>
<div id="output-instances" class="section level1">
<h1 class="hasAnchor">
<a href="#output-instances" class="anchor"></a>Output Instances</h1>
<p>The different output instances can be characterized by different dimensions. One dimension is the amount of information that is shown in the output. In this first dimension, we can separate between exercise problem and problem solutions. A third category is the exercise notebooks.</p>
<p>The second dimension is the deployment target. In this dimension, we can distinguish between the website and the exercise platform.</p>
<p>The following diagram shows the different dimensions.</p>
<p><img src="odg/output-instance.png" width="871"></p>
</div>
<div id="strategy" class="section level1">
<h1 class="hasAnchor">
<a href="#strategy" class="anchor"></a>Strategy</h1>
<p>In a first step, we have to produce the different versions of the source files from the unified Rmd source file to produce the different output instances.</p>
<div id="solution" class="section level2">
<h2 class="hasAnchor">
<a href="#solution" class="anchor"></a>Solution</h2>
<p>The source file for the solution output instances are produced from the unchanged unified Rmd source file. The pdf-document with the solutions are created by rendering the unified Rmd source file. For the exercise platform the original unified Rmd source document is used.</p>
</div>
<div id="exercise-problems" class="section level2">
<h2 class="hasAnchor">
<a href="#exercise-problems" class="anchor"></a>Exercise Problems</h2>
<p>The output instances for the exercise problems are produced by cutting out the solution sections and the augmented information for the exercise notebook for the exercise platform. After cutting out the solutions and the augmented information, a reduced source file containing only the exercise problems is produced. This reduced source file is used to produce the pdf-document for the website.</p>
</div>
<div id="augmented-problems" class="section level2">
<h2 class="hasAnchor">
<a href="#augmented-problems" class="anchor"></a>Augmented Problems</h2>
<p>The augmented information consist of hints to the students on how they should procede in their solution process. This augmented information is commented out in the unified Rmd source file.</p>
</div>
</div>
<div id="approach" class="section level1">
<h1 class="hasAnchor">
<a href="#approach" class="anchor"></a>Approach</h1>
<p>The proposed approach to a first solution is outlined in this section. In a first step the unified Rmd source file is read into a character vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s_uni_src_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"asm_ex06.Rmd"</span>, package <span class="op">=</span> <span class="st">"rteachtools"</span><span class="op">)</span>
<span class="va">vec_uni_src</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">s_uni_src_path</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">vec_uni_src</span><span class="op">)</span>
<span class="co">#&gt; [1] "---"                                                                          </span>
<span class="co">#&gt; [2] "title: Applied Statistical Methods - `r tools::toTitleCase(params$doctype)` 6"</span>
<span class="co">#&gt; [3] "author: Peter von Rohr"                                                       </span>
<span class="co">#&gt; [4] "date: \"2021-03-29\""                                                         </span>
<span class="co">#&gt; [5] "output:"                                                                      </span>
<span class="co">#&gt; [6] "  bookdown::pdf_document2:"</span></code></pre></div>
<div id="modification-of-unified-source-file" class="section level2">
<h2 class="hasAnchor">
<a href="#modification-of-unified-source-file" class="anchor"></a>Modification of Unified Source File</h2>
<p>The modification of the unified source file consists of cutting out sections which can be identified by tags. Hence, we need a function that uses as input a character vector containing the original source file and the tags and returns a character vector that does not contain the section between the tags.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cut_section</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pvec_src</span>, <span class="va">pl_tag</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># pvec_src = vec_uni_src; pl_tag = list(start="master-solution-start", end = "master-solution-end")</span>
  <span class="co"># determine the start and the end positions of the section to be cut out</span>
  <span class="va">vec_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">pl_tag</span><span class="op">$</span><span class="va">start</span>, <span class="va">pvec_src</span><span class="op">)</span>
  <span class="va">n_nr_tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vec_start</span><span class="op">)</span>
  <span class="va">vec_end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">pl_tag</span><span class="op">$</span><span class="va">end</span>, <span class="va">pvec_src</span><span class="op">)</span>
  <span class="co"># check that start and end positions have the same length</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n_nr_tag</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vec_end</span><span class="op">)</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">" *** Error: number of start and end-tags not equal"</span><span class="op">)</span>
  <span class="co"># put together the result</span>
  <span class="va">vec_result</span> <span class="op">&lt;-</span> <span class="va">pvec_src</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">vec_start</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>
  <span class="co"># add the remaining sections</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n_nr_tag</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">idx</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n_nr_tag</span><span class="op">)</span><span class="op">{</span>
      <span class="va">vec_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">vec_result</span>,
                      <span class="va">pvec_src</span><span class="op">[</span><span class="op">(</span><span class="va">vec_end</span><span class="op">[</span><span class="va">idx</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">vec_start</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="co"># if after last end-tag there are any further lines, add them</span>
  <span class="va">n_src_len</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pvec_src</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n_src_len</span> <span class="op">&gt;</span> <span class="va">vec_end</span><span class="op">[</span><span class="va">n_nr_tag</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
    <span class="va">vec_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">vec_result</span>,
                    <span class="va">pvec_src</span><span class="op">[</span><span class="op">(</span><span class="va">vec_end</span><span class="op">[</span><span class="va">n_nr_tag</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n_src_len</span><span class="op">]</span><span class="op">)</span>  
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vec_result</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The above function can be tested with</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec_ex_aug</span> <span class="op">&lt;-</span> <span class="fu">cut_section</span><span class="op">(</span>pvec_src <span class="op">=</span> <span class="va">vec_uni_src</span>, pl_tag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">"master-solution-start"</span>, end <span class="op">=</span> <span class="st">"master-solution-end"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>When also cutting out the augmented information, then the vector with only the exercise information is obtained.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec_ex</span> <span class="op">&lt;-</span> <span class="fu">cut_section</span><span class="op">(</span>pvec_src <span class="op">=</span> <span class="va">vec_ex_aug</span>, pl_tag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">"your-solution-start"</span>, end <span class="op">=</span> <span class="st">"your-solution-end"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The source file for the exercise can be created by writing <code>vec_ex</code> to a file which can then be rendered and/or copied to the deployment targets.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">vec_ex</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>, <span class="st">"\n"</span>, file <span class="op">=</span> <span class="st">"ex.Rmd"</span><span class="op">)</span></code></pre></div>
<p>The rendering is done using</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">render</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"ex.Rmd"</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>doctype <span class="op">=</span> <span class="st">"exercise"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Clean up the output</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/delete.html">file_delete</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ex.Rmd"</span>, <span class="st">"ex.pdf"</span>, <span class="st">"ex.log"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="create-exercise-notebook" class="section level2">
<h2 class="hasAnchor">
<a href="#create-exercise-notebook" class="anchor"></a>Create Exercise Notebook</h2>
<p>We have already created the sources for the notebook. These sources must be modified more to be able to produce a notebook. First, we have to remove the lines with the comment-start- and comment-end-tags. This causes the augmented information to appear in the notebook. After that the yaml header must be changed to produce a notebook.</p>
<p>The following function <code>cut_line()</code> is used to remove a given line.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cut_line</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pvec_src</span>, <span class="va">pvec_pattern</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># vector with line indices where the pattern is found</span>
  <span class="va">vec_line_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pvec_pattern</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">x</span>, <span class="va">pvec_src</span><span class="op">)</span>, USE.NAMES <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># set the result</span>
  <span class="va">vec_result</span> <span class="op">&lt;-</span> <span class="va">pvec_src</span><span class="op">[</span><span class="op">-</span><span class="va">vec_line_idx</span><span class="op">]</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vec_result</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The test works with</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec_ex_aug</span> <span class="op">&lt;-</span> <span class="fu">cut_line</span><span class="op">(</span>pvec_src <span class="op">=</span> <span class="va">vec_ex_aug</span>, pvec_pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"your-solution-start"</span>, <span class="st">"your-solution-end"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
